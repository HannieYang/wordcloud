{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { get, set, omit, each } from '@antv/util';\nimport { interaction, theme, tooltip, annotation as baseAnnotation } from '../../adaptor/common';\nimport { interval, point, violin } from '../../adaptor/geometries';\nimport { flow, pick, deepAssign, findViewById } from '../../utils';\nimport { AXIS_META_CONFIG_KEYS } from '../../constant';\nimport { transformViolinData } from './utils';\nimport { MEDIAN_FIELD, MEDIAN_VIEW_ID, MIN_MAX_FIELD, MIN_MAX_VIEW_ID, QUANTILE_FIELD, QUANTILE_VIEW_ID, VIOLIN_SIZE_FIELD, VIOLIN_VIEW_ID, VIOLIN_Y_FIELD, X_FIELD } from './constant';\nvar TOOLTIP_FIELDS = ['low', 'high', 'q1', 'q3', 'median'];\nvar adjustCfg = [{\n  type: 'dodge',\n  marginRatio: 1 / 32\n}];\n/** 处理数据 */\n\nfunction data(params) {\n  var chart = params.chart,\n      options = params.options;\n  chart.data(transformViolinData(options));\n  return params;\n}\n/** 小提琴轮廓 */\n\n\nfunction violinView(params) {\n  var chart = params.chart,\n      options = params.options;\n  var seriesField = options.seriesField,\n      color = options.color,\n      _a = options.shape,\n      shape = _a === void 0 ? 'violin' : _a,\n      violinStyle = options.violinStyle,\n      tooltip = options.tooltip,\n      state = options.state;\n  var view = chart.createView({\n    id: VIOLIN_VIEW_ID\n  });\n  violin({\n    chart: view,\n    options: {\n      xField: X_FIELD,\n      yField: VIOLIN_Y_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      sizeField: VIOLIN_SIZE_FIELD,\n      tooltip: __assign({\n        fields: TOOLTIP_FIELDS\n      }, tooltip),\n      violin: {\n        style: violinStyle,\n        color: color,\n        shape: shape\n      },\n      state: state\n    }\n  });\n  view.geometries[0].adjust(adjustCfg);\n  return params;\n}\n/** 箱线 */\n\n\nfunction boxView(params) {\n  var chart = params.chart,\n      options = params.options;\n  var seriesField = options.seriesField,\n      color = options.color,\n      tooltip = options.tooltip,\n      box = options.box; // 如果配置 `box` 为 false ，不渲染内部箱线图\n\n  if (box === false) return params; // 边缘线\n\n  var minMaxView = chart.createView({\n    id: MIN_MAX_VIEW_ID\n  });\n  interval({\n    chart: minMaxView,\n    options: {\n      xField: X_FIELD,\n      yField: MIN_MAX_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      tooltip: __assign({\n        fields: TOOLTIP_FIELDS\n      }, tooltip),\n      state: typeof box === 'object' ? box.state : {},\n      interval: {\n        color: color,\n        size: 1,\n        style: {\n          lineWidth: 0\n        }\n      }\n    }\n  });\n  minMaxView.geometries[0].adjust(adjustCfg); // 四分点位\n\n  var quantileView = chart.createView({\n    id: QUANTILE_VIEW_ID\n  });\n  interval({\n    chart: quantileView,\n    options: {\n      xField: X_FIELD,\n      yField: QUANTILE_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      tooltip: __assign({\n        fields: TOOLTIP_FIELDS\n      }, tooltip),\n      state: typeof box === 'object' ? box.state : {},\n      interval: {\n        color: color,\n        size: 8,\n        style: {\n          fillOpacity: 1\n        }\n      }\n    }\n  });\n  quantileView.geometries[0].adjust(adjustCfg); // 中位值\n\n  var medianView = chart.createView({\n    id: MEDIAN_VIEW_ID\n  });\n  point({\n    chart: medianView,\n    options: {\n      xField: X_FIELD,\n      yField: MEDIAN_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      tooltip: __assign({\n        fields: TOOLTIP_FIELDS\n      }, tooltip),\n      state: typeof box === 'object' ? box.state : {},\n      point: {\n        color: color,\n        size: 1,\n        style: {\n          fill: 'white',\n          lineWidth: 0\n        }\n      }\n    }\n  });\n  medianView.geometries[0].adjust(adjustCfg); // 关闭辅助 view 的轴\n\n  quantileView.axis(false);\n  minMaxView.axis(false);\n  medianView.axis(false); // 关闭辅助 view 的图例\n\n  medianView.legend(false);\n  minMaxView.legend(false);\n  quantileView.legend(false);\n  return params;\n}\n/**\n * meta 配置\n */\n\n\nfunction meta(params) {\n  var _a;\n\n  var chart = params.chart,\n      options = params.options;\n  var meta = options.meta,\n      xAxis = options.xAxis,\n      yAxis = options.yAxis;\n  var baseMeta = {};\n  var scales = deepAssign(baseMeta, meta, (_a = {}, _a[X_FIELD] = __assign(__assign({\n    sync: true\n  }, pick(xAxis, AXIS_META_CONFIG_KEYS)), {\n    // fix:  dodge is not support linear attribute, please use category attribute!\n    // 强制 x 轴类型为分类类型\n    type: 'cat'\n  }), _a[VIOLIN_Y_FIELD] = __assign({\n    sync: true\n  }, pick(yAxis, AXIS_META_CONFIG_KEYS)), _a[MIN_MAX_FIELD] = __assign({\n    sync: VIOLIN_Y_FIELD\n  }, pick(yAxis, AXIS_META_CONFIG_KEYS)), _a[QUANTILE_FIELD] = __assign({\n    sync: VIOLIN_Y_FIELD\n  }, pick(yAxis, AXIS_META_CONFIG_KEYS)), _a[MEDIAN_FIELD] = __assign({\n    sync: VIOLIN_Y_FIELD\n  }, pick(yAxis, AXIS_META_CONFIG_KEYS)), _a));\n  chart.scale(scales);\n  return params;\n}\n/**\n * axis 配置\n */\n\n\nfunction axis(params) {\n  var chart = params.chart,\n      options = params.options;\n  var xAxis = options.xAxis,\n      yAxis = options.yAxis;\n  var view = findViewById(chart, VIOLIN_VIEW_ID); // 为 false 则是不显示轴\n\n  if (xAxis === false) {\n    view.axis(X_FIELD, false);\n  } else {\n    view.axis(X_FIELD, xAxis);\n  }\n\n  if (yAxis === false) {\n    view.axis(VIOLIN_Y_FIELD, false);\n  } else {\n    view.axis(VIOLIN_Y_FIELD, yAxis);\n  }\n\n  chart.axis(false);\n  return params;\n}\n/**\n *\n * @param params\n * @returns\n */\n\n\nfunction legend(params) {\n  var chart = params.chart,\n      options = params.options;\n  var legend = options.legend,\n      seriesField = options.seriesField,\n      shape = options.shape;\n\n  if (legend === false) {\n    chart.legend(false);\n  } else {\n    var legendField_1 = seriesField ? seriesField : X_FIELD; // fixme 暂不明为啥有描边\n\n    var legendOptions = omit(legend, ['selected']);\n\n    if (!shape || !shape.startsWith('hollow')) {\n      if (!get(legendOptions, ['marker', 'style', 'lineWidth'])) {\n        set(legendOptions, ['marker', 'style', 'lineWidth'], 0);\n      }\n    }\n\n    chart.legend(legendField_1, legendOptions); // 特殊的处理 fixme G2 层得解决这个问题\n\n    if (get(legend, 'selected')) {\n      each(chart.views, function (view) {\n        return view.legend(legendField_1, legend);\n      });\n    }\n  }\n\n  return params;\n}\n/**\n * annotation, apply to violin view.\n * @param params\n * @returns\n */\n\n\nfunction annotation(params) {\n  var chart = params.chart;\n  var violinView = findViewById(chart, VIOLIN_VIEW_ID);\n  baseAnnotation()(__assign(__assign({}, params), {\n    chart: violinView\n  }));\n  return params;\n}\n/**\n * 动画\n * @param params\n */\n\n\nexport function animation(params) {\n  var chart = params.chart,\n      options = params.options;\n  var animation = options.animation; // 所有的 Geometry 都使用同一动画（各个图形如有区别，自行覆盖）\n\n  each(chart.views, function (view) {\n    // 同时设置整个 view 动画选项\n    if (typeof animation === 'boolean') {\n      view.animate(animation);\n    } else {\n      view.animate(true);\n    }\n\n    each(view.geometries, function (g) {\n      g.animate(animation);\n    });\n  });\n  return params;\n}\n/**\n * 小提琴图适配器\n * @param params\n */\n\nexport function adaptor(params) {\n  return flow(theme, data, violinView, boxView, meta, tooltip, axis, legend, interaction, annotation, animation)(params);\n}","map":{"version":3,"mappings":"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","names":["get","set","omit","each","interaction","theme","tooltip","annotation","baseAnnotation","interval","point","violin","flow","pick","deepAssign","findViewById","AXIS_META_CONFIG_KEYS","transformViolinData","MEDIAN_FIELD","MEDIAN_VIEW_ID","MIN_MAX_FIELD","MIN_MAX_VIEW_ID","QUANTILE_FIELD","QUANTILE_VIEW_ID","VIOLIN_SIZE_FIELD","VIOLIN_VIEW_ID","VIOLIN_Y_FIELD","X_FIELD","TOOLTIP_FIELDS","adjustCfg","type","marginRatio","data","params","options","chart","violinView","color","_a","shape","violinStyle","state","view","createView","id","xField","yField","seriesField","sizeField","fields","style","geometries","adjust","boxView","box","minMaxView","size","lineWidth","quantileView","fillOpacity","medianView","fill","axis","legend","meta","xAxis","yAxis","baseMeta","scales","__assign","sync","scale","legendField_1","legendOptions","startsWith","views","animation","animate","g","adaptor"],"sourceRoot":"","sources":["../../../src/plots/violin/adaptor.ts"],"sourcesContent":["import { Geometry } from '@antv/g2';\nimport { get, set, omit, each } from '@antv/util';\nimport { Params } from '../../core/adaptor';\nimport { interaction, theme, tooltip, annotation as baseAnnotation } from '../../adaptor/common';\nimport { interval, point, violin } from '../../adaptor/geometries';\nimport { flow, pick, deepAssign, findViewById } from '../../utils';\nimport { AXIS_META_CONFIG_KEYS } from '../../constant';\nimport { ViolinOptions } from './types';\nimport { transformViolinData } from './utils';\nimport {\n  MEDIAN_FIELD,\n  MEDIAN_VIEW_ID,\n  MIN_MAX_FIELD,\n  MIN_MAX_VIEW_ID,\n  QUANTILE_FIELD,\n  QUANTILE_VIEW_ID,\n  VIOLIN_SIZE_FIELD,\n  VIOLIN_VIEW_ID,\n  VIOLIN_Y_FIELD,\n  X_FIELD,\n} from './constant';\n\nconst TOOLTIP_FIELDS = ['low', 'high', 'q1', 'q3', 'median'];\n\nconst adjustCfg = [\n  {\n    type: 'dodge',\n    marginRatio: 1 / 32,\n  } as const,\n];\n\n/** 处理数据 */\nfunction data(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  chart.data(transformViolinData(options));\n  return params;\n}\n\n/** 小提琴轮廓 */\nfunction violinView(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  const { seriesField, color, shape = 'violin', violinStyle, tooltip, state } = options;\n\n  const view = chart.createView({ id: VIOLIN_VIEW_ID });\n  violin({\n    chart: view,\n    options: {\n      xField: X_FIELD,\n      yField: VIOLIN_Y_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      sizeField: VIOLIN_SIZE_FIELD,\n      tooltip: {\n        fields: TOOLTIP_FIELDS,\n        ...tooltip,\n      },\n      violin: {\n        style: violinStyle,\n        color,\n        shape,\n      },\n      state,\n    },\n  });\n  view.geometries[0].adjust(adjustCfg);\n\n  return params;\n}\n\n/** 箱线 */\nfunction boxView(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  const { seriesField, color, tooltip, box } = options;\n\n  // 如果配置 `box` 为 false ，不渲染内部箱线图\n  if (box === false) return params;\n\n  // 边缘线\n  const minMaxView = chart.createView({ id: MIN_MAX_VIEW_ID });\n  interval({\n    chart: minMaxView,\n    options: {\n      xField: X_FIELD,\n      yField: MIN_MAX_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      tooltip: {\n        fields: TOOLTIP_FIELDS,\n        ...tooltip,\n      },\n      state: typeof box === 'object' ? box.state : {},\n      interval: {\n        color,\n        size: 1,\n        style: {\n          lineWidth: 0,\n        },\n      },\n    },\n  });\n  minMaxView.geometries[0].adjust(adjustCfg);\n\n  // 四分点位\n  const quantileView = chart.createView({ id: QUANTILE_VIEW_ID });\n  interval({\n    chart: quantileView,\n    options: {\n      xField: X_FIELD,\n      yField: QUANTILE_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      tooltip: {\n        fields: TOOLTIP_FIELDS,\n        ...tooltip,\n      },\n      state: typeof box === 'object' ? box.state : {},\n      interval: {\n        color,\n        size: 8,\n        style: {\n          fillOpacity: 1,\n        },\n      },\n    },\n  });\n  quantileView.geometries[0].adjust(adjustCfg);\n\n  // 中位值\n  const medianView = chart.createView({ id: MEDIAN_VIEW_ID });\n  point({\n    chart: medianView,\n    options: {\n      xField: X_FIELD,\n      yField: MEDIAN_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      tooltip: {\n        fields: TOOLTIP_FIELDS,\n        ...tooltip,\n      },\n      state: typeof box === 'object' ? box.state : {},\n      point: {\n        color,\n        size: 1,\n        style: {\n          fill: 'white',\n          lineWidth: 0,\n        },\n      },\n    },\n  });\n  medianView.geometries[0].adjust(adjustCfg);\n\n  // 关闭辅助 view 的轴\n  quantileView.axis(false);\n  minMaxView.axis(false);\n  medianView.axis(false);\n\n  // 关闭辅助 view 的图例\n  medianView.legend(false);\n  minMaxView.legend(false);\n  quantileView.legend(false);\n\n  return params;\n}\n\n/**\n * meta 配置\n */\nfunction meta(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  const { meta, xAxis, yAxis } = options;\n\n  const baseMeta = {};\n\n  const scales = deepAssign(baseMeta, meta, {\n    [X_FIELD]: {\n      sync: true,\n      ...pick(xAxis, AXIS_META_CONFIG_KEYS),\n      // fix:  dodge is not support linear attribute, please use category attribute!\n      // 强制 x 轴类型为分类类型\n      type: 'cat',\n    },\n    [VIOLIN_Y_FIELD]: {\n      sync: true,\n      ...pick(yAxis, AXIS_META_CONFIG_KEYS),\n    },\n    [MIN_MAX_FIELD]: {\n      sync: VIOLIN_Y_FIELD,\n      ...pick(yAxis, AXIS_META_CONFIG_KEYS),\n    },\n    [QUANTILE_FIELD]: {\n      sync: VIOLIN_Y_FIELD,\n      ...pick(yAxis, AXIS_META_CONFIG_KEYS),\n    },\n    [MEDIAN_FIELD]: {\n      sync: VIOLIN_Y_FIELD,\n      ...pick(yAxis, AXIS_META_CONFIG_KEYS),\n    },\n  });\n\n  chart.scale(scales);\n\n  return params;\n}\n\n/**\n * axis 配置\n */\nfunction axis(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  const { xAxis, yAxis } = options;\n\n  const view = findViewById(chart, VIOLIN_VIEW_ID);\n\n  // 为 false 则是不显示轴\n  if (xAxis === false) {\n    view.axis(X_FIELD, false);\n  } else {\n    view.axis(X_FIELD, xAxis);\n  }\n\n  if (yAxis === false) {\n    view.axis(VIOLIN_Y_FIELD, false);\n  } else {\n    view.axis(VIOLIN_Y_FIELD, yAxis);\n  }\n\n  chart.axis(false);\n\n  return params;\n}\n\n/**\n *\n * @param params\n * @returns\n */\nfunction legend(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  const { legend, seriesField, shape } = options;\n\n  if (legend === false) {\n    chart.legend(false);\n  } else {\n    const legendField = seriesField ? seriesField : X_FIELD;\n    // fixme 暂不明为啥有描边\n    const legendOptions = omit(legend as any, ['selected']);\n    if (!shape || !shape.startsWith('hollow')) {\n      if (!get(legendOptions, ['marker', 'style', 'lineWidth'])) {\n        set(legendOptions, ['marker', 'style', 'lineWidth'], 0);\n      }\n    }\n    chart.legend(legendField, legendOptions);\n    // 特殊的处理 fixme G2 层得解决这个问题\n    if (get(legend, 'selected')) {\n      each(chart.views, (view) => view.legend(legendField, legend));\n    }\n  }\n\n  return params;\n}\n\n/**\n * annotation, apply to violin view.\n * @param params\n * @returns\n */\nfunction annotation(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart } = params;\n\n  const violinView = findViewById(chart, VIOLIN_VIEW_ID);\n  baseAnnotation()({ ...params, chart: violinView });\n\n  return params;\n}\n\n/**\n * 动画\n * @param params\n */\nexport function animation(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  const { animation } = options;\n\n  // 所有的 Geometry 都使用同一动画（各个图形如有区别，自行覆盖）\n  each(chart.views, (view) => {\n    // 同时设置整个 view 动画选项\n    if (typeof animation === 'boolean') {\n      view.animate(animation);\n    } else {\n      view.animate(true);\n    }\n\n    each(view.geometries, (g: Geometry) => {\n      g.animate(animation);\n    });\n  });\n\n  return params;\n}\n\n/**\n * 小提琴图适配器\n * @param params\n */\nexport function adaptor(params: Params<ViolinOptions>) {\n  return flow(\n    theme,\n    data,\n    violinView,\n    boxView,\n    meta,\n    tooltip,\n    axis,\n    legend,\n    interaction,\n    annotation,\n    animation\n  )(params);\n}\n"]},"metadata":{},"sourceType":"module"}