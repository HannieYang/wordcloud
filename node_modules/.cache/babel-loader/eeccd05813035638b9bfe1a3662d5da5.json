{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { each, omit } from '@antv/util';\nimport { theme } from '../../adaptor/common';\nimport { AXIS_META_CONFIG_KEYS } from '../../constant';\nimport { pick, flow, deepAssign } from '../../utils';\nimport { execPlotAdaptor } from '../mix/utils';\nimport { execViewAdaptor } from './utils';\n\nfunction facetAdaptor(params) {\n  var chart = params.chart,\n      options = params.options;\n  var facetType = options.type,\n      data = options.data,\n      fields = options.fields,\n      eachView = options.eachView;\n  var restFacetCfg = omit(options, ['type', 'data', 'fields', 'eachView', 'axes', 'meta', 'tooltip', 'coordinate', 'theme', 'legend', 'interactions', 'annotations']); // 1. data\n\n  chart.data(data); // 2. facet\n\n  chart.facet(facetType, __assign(__assign({}, restFacetCfg), {\n    fields: fields,\n    eachView: function (viewOfG2, facet) {\n      var viewOptions = eachView(viewOfG2, facet);\n\n      if (viewOptions.geometries) {\n        execViewAdaptor(viewOfG2, viewOptions);\n      } else {\n        var plot = viewOptions;\n        var plotOptions = plot.options; // @ts-ignore 仪表盘没 tooltip\n\n        if (plotOptions.tooltip) {\n          // 配置 tooltip 交互\n          viewOfG2.interaction('tooltip');\n        }\n\n        execPlotAdaptor(plot.type, viewOfG2, plotOptions);\n      }\n    }\n  }));\n  return params;\n}\n\nfunction component(params) {\n  var chart = params.chart,\n      options = params.options;\n  var axes = options.axes,\n      meta = options.meta,\n      tooltip = options.tooltip,\n      coordinate = options.coordinate,\n      theme = options.theme,\n      legend = options.legend,\n      interactions = options.interactions,\n      annotations = options.annotations; // 3. meta 配置\n\n  var scales = {};\n\n  if (axes) {\n    each(axes, function (axis, field) {\n      scales[field] = pick(axis, AXIS_META_CONFIG_KEYS);\n    });\n  }\n\n  scales = deepAssign({}, meta, scales);\n  chart.scale(scales); // 4. coordinate 配置\n\n  chart.coordinate(coordinate); // 5. axis 轴配置 (默认不展示)\n\n  if (!axes) {\n    chart.axis(false);\n  } else {\n    each(axes, function (axis, field) {\n      chart.axis(field, axis);\n    });\n  } // 6. tooltip 配置\n\n\n  if (tooltip) {\n    chart.interaction('tooltip');\n    chart.tooltip(tooltip);\n  } else if (tooltip === false) {\n    chart.removeInteraction('tooltip');\n  } // 7. legend 配置（默认展示）\n\n\n  chart.legend(legend); // theme 配置\n\n  if (theme) {\n    chart.theme(theme);\n  } // 8. interactions\n\n\n  each(interactions, function (interaction) {\n    if (interaction.enable === false) {\n      chart.removeInteraction(interaction.type);\n    } else {\n      chart.interaction(interaction.type, interaction.cfg);\n    }\n  }); // 9. annotations\n\n  each(annotations, function (annotation) {\n    chart.annotation()[annotation.type](__assign({}, annotation));\n  });\n  return params;\n}\n/**\n * 分面图适配器\n * @param chart\n * @param options\n */\n\n\nexport function adaptor(params) {\n  // flow 的方式处理所有的配置到 G2 API\n  return flow(theme, facetAdaptor, component)(params);\n}","map":{"version":3,"mappings":"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","names":["each","omit","theme","AXIS_META_CONFIG_KEYS","pick","flow","deepAssign","execPlotAdaptor","execViewAdaptor","facetAdaptor","params","options","facetType","data","fields","eachView","restFacetCfg","chart","facet","__assign","viewOfG2","viewOptions","geometries","plot","plotOptions","tooltip","interaction","type","component","meta","coordinate","legend","interactions","annotations","scales","axes","axis","field","scale","removeInteraction","enable","cfg","annotation","adaptor"],"sourceRoot":"","sources":["../../../src/plots/facet/adaptor.ts"],"sourcesContent":["import { each, omit } from '@antv/util';\nimport { theme } from '../../adaptor/common';\nimport { Params } from '../../core/adaptor';\nimport { AXIS_META_CONFIG_KEYS } from '../../constant';\nimport { pick, flow, deepAssign } from '../../utils';\nimport { Axis, Interaction } from '../../types';\nimport { execPlotAdaptor } from '../mix/utils';\nimport { FacetOptions, IPlot, IView } from './types';\nimport { execViewAdaptor } from './utils';\n\nfunction facetAdaptor(params: Params<FacetOptions>): Params<FacetOptions> {\n  const { chart, options } = params;\n  const { type: facetType, data, fields, eachView } = options;\n\n  const restFacetCfg = omit(options as any, [\n    'type',\n    'data',\n    'fields',\n    'eachView',\n    'axes',\n    'meta',\n    'tooltip',\n    'coordinate',\n    'theme',\n    'legend',\n    'interactions',\n    'annotations',\n  ]);\n\n  // 1. data\n  chart.data(data);\n\n  // 2. facet\n  chart.facet(facetType, {\n    ...restFacetCfg,\n    fields,\n    eachView: (viewOfG2, facet) => {\n      const viewOptions = eachView(viewOfG2, facet);\n      if ((viewOptions as IView).geometries) {\n        execViewAdaptor(viewOfG2, viewOptions as IView);\n      } else {\n        const plot = viewOptions as IPlot;\n        const plotOptions = plot.options;\n        // @ts-ignore 仪表盘没 tooltip\n        if (plotOptions.tooltip) {\n          // 配置 tooltip 交互\n          viewOfG2.interaction('tooltip');\n        }\n        execPlotAdaptor(plot.type, viewOfG2, plotOptions);\n      }\n    },\n  });\n\n  return params;\n}\n\nfunction component(params: Params<FacetOptions>): Params<FacetOptions> {\n  const { chart, options } = params;\n  const { axes, meta, tooltip, coordinate, theme, legend, interactions, annotations } = options;\n\n  // 3. meta 配置\n  let scales: Record<string, any> = {};\n  if (axes) {\n    each(axes, (axis: Axis, field: string) => {\n      scales[field] = pick(axis, AXIS_META_CONFIG_KEYS);\n    });\n  }\n\n  scales = deepAssign({}, meta, scales);\n  chart.scale(scales);\n\n  // 4. coordinate 配置\n  chart.coordinate(coordinate);\n\n  // 5. axis 轴配置 (默认不展示)\n  if (!axes) {\n    chart.axis(false);\n  } else {\n    each(axes, (axis: Axis, field: string) => {\n      chart.axis(field, axis);\n    });\n  }\n\n  // 6. tooltip 配置\n  if (tooltip) {\n    chart.interaction('tooltip');\n    chart.tooltip(tooltip);\n  } else if (tooltip === false) {\n    chart.removeInteraction('tooltip');\n  }\n\n  // 7. legend 配置（默认展示）\n  chart.legend(legend);\n\n  // theme 配置\n  if (theme) {\n    chart.theme(theme);\n  }\n\n  // 8. interactions\n  each(interactions, (interaction: Interaction) => {\n    if (interaction.enable === false) {\n      chart.removeInteraction(interaction.type);\n    } else {\n      chart.interaction(interaction.type, interaction.cfg);\n    }\n  });\n\n  // 9. annotations\n  each(annotations, (annotation) => {\n    chart.annotation()[annotation.type]({\n      ...annotation,\n    });\n  });\n\n  return params;\n}\n\n/**\n * 分面图适配器\n * @param chart\n * @param options\n */\nexport function adaptor(params: Params<FacetOptions>) {\n  // flow 的方式处理所有的配置到 G2 API\n  return flow(theme, facetAdaptor, component)(params);\n}\n"]},"metadata":{},"sourceType":"module"}