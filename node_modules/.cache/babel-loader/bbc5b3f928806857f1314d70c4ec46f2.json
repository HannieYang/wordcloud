{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { ext, vec2, vec3 } from '@antv/matrix-util';\nimport { isNumberEqual } from '@antv/util';\nimport Coordinate from './base';\n\nvar Polar =\n/** @class */\nfunction (_super) {\n  __extends(Polar, _super);\n\n  function Polar(cfg) {\n    var _this = _super.call(this, cfg) || this;\n\n    _this.isPolar = true;\n    _this.type = 'polar';\n    var _a = cfg.startAngle,\n        startAngle = _a === void 0 ? -Math.PI / 2 : _a,\n        _b = cfg.endAngle,\n        endAngle = _b === void 0 ? Math.PI * 3 / 2 : _b,\n        _c = cfg.innerRadius,\n        innerRadius = _c === void 0 ? 0 : _c,\n        radius = cfg.radius;\n    _this.startAngle = startAngle;\n    _this.endAngle = endAngle;\n    _this.innerRadius = innerRadius;\n    _this.radius = radius;\n\n    _this.initial();\n\n    return _this;\n  }\n\n  Polar.prototype.initial = function () {\n    _super.prototype.initial.call(this);\n\n    while (this.endAngle < this.startAngle) {\n      this.endAngle += Math.PI * 2;\n    }\n\n    var oneBox = this.getOneBox();\n    var oneWidth = oneBox.maxX - oneBox.minX;\n    var oneHeight = oneBox.maxY - oneBox.minY;\n    var left = Math.abs(oneBox.minX) / oneWidth;\n    var top = Math.abs(oneBox.minY) / oneHeight;\n    var maxRadius;\n\n    if (this.height / oneHeight > this.width / oneWidth) {\n      // width 为主\n      maxRadius = this.width / oneWidth;\n      this.circleCenter = {\n        x: this.center.x - (0.5 - left) * this.width,\n        y: this.center.y - (0.5 - top) * maxRadius * oneHeight\n      };\n    } else {\n      // height 为主\n      maxRadius = this.height / oneHeight;\n      this.circleCenter = {\n        x: this.center.x - (0.5 - left) * maxRadius * oneWidth,\n        y: this.center.y - (0.5 - top) * this.height\n      };\n    }\n\n    this.polarRadius = this.radius;\n\n    if (!this.radius) {\n      this.polarRadius = maxRadius;\n    } else if (this.radius > 0 && this.radius <= 1) {\n      this.polarRadius = maxRadius * this.radius;\n    } else if (this.radius <= 0 || this.radius > maxRadius) {\n      this.polarRadius = maxRadius;\n    }\n\n    this.x = {\n      start: this.startAngle,\n      end: this.endAngle\n    };\n    this.y = {\n      start: this.innerRadius * this.polarRadius,\n      end: this.polarRadius\n    };\n  };\n\n  Polar.prototype.getRadius = function () {\n    return this.polarRadius;\n  };\n\n  Polar.prototype.convertPoint = function (point) {\n    var _a;\n\n    var center = this.getCenter();\n    var x = point.x,\n        y = point.y;\n\n    if (this.isTransposed) {\n      _a = [y, x], x = _a[0], y = _a[1];\n    }\n\n    x = this.convertDim(x, 'x');\n    y = this.convertDim(y, 'y');\n    return {\n      x: center.x + Math.cos(x) * y,\n      y: center.y + Math.sin(x) * y\n    };\n  };\n\n  Polar.prototype.invertPoint = function (point) {\n    var _a;\n\n    var center = this.getCenter();\n    var vPoint = [point.x - center.x, point.y - center.y];\n\n    var _b = this,\n        startAngle = _b.startAngle,\n        endAngle = _b.endAngle;\n\n    if (this.isReflect('x')) {\n      _a = [endAngle, startAngle], startAngle = _a[0], endAngle = _a[1];\n    }\n\n    var m = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    ext.leftRotate(m, m, startAngle);\n    var vStart3 = [1, 0, 0];\n    vec3.transformMat3(vStart3, vStart3, m);\n    var vStart2 = [vStart3[0], vStart3[1]];\n    var angle = ext.angleTo(vStart2, vPoint, endAngle < startAngle);\n\n    if (isNumberEqual(angle, Math.PI * 2)) {\n      angle = 0;\n    }\n\n    var radius = vec2.length(vPoint);\n    var xPercent = angle / (endAngle - startAngle);\n    xPercent = endAngle - startAngle > 0 ? xPercent : -xPercent;\n    var yPercent = this.invertDim(radius, 'y');\n    var rst = {\n      x: 0,\n      y: 0\n    };\n    rst.x = this.isTransposed ? yPercent : xPercent;\n    rst.y = this.isTransposed ? xPercent : yPercent;\n    return rst;\n  };\n\n  Polar.prototype.getCenter = function () {\n    return this.circleCenter;\n  };\n\n  Polar.prototype.getOneBox = function () {\n    var startAngle = this.startAngle;\n    var endAngle = this.endAngle;\n\n    if (Math.abs(endAngle - startAngle) >= Math.PI * 2) {\n      return {\n        minX: -1,\n        maxX: 1,\n        minY: -1,\n        maxY: 1\n      };\n    }\n\n    var xs = [0, Math.cos(startAngle), Math.cos(endAngle)];\n    var ys = [0, Math.sin(startAngle), Math.sin(endAngle)];\n\n    for (var i = Math.min(startAngle, endAngle); i < Math.max(startAngle, endAngle); i += Math.PI / 18) {\n      xs.push(Math.cos(i));\n      ys.push(Math.sin(i));\n    }\n\n    return {\n      minX: Math.min.apply(Math, xs),\n      maxX: Math.max.apply(Math, xs),\n      minY: Math.min.apply(Math, ys),\n      maxY: Math.max.apply(Math, ys)\n    };\n  };\n\n  return Polar;\n}(Coordinate);\n\nexport default Polar;","map":{"version":3,"mappings":"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","names":["ext","vec2","vec3","isNumberEqual","Coordinate","__extends","cfg","_super","_this","Math","PI","_a","_b","endAngle","_c","innerRadius","radius","startAngle","initial","Polar","call","oneBox","getOneBox","oneWidth","maxX","minX","oneHeight","maxY","minY","left","abs","top","maxRadius","height","width","circleCenter","x","center","y","polarRadius","start","end","point","getCenter","isTransposed","convertDim","cos","sin","vPoint","isReflect","m","leftRotate","vStart3","transformMat3","vStart2","angle","angleTo","length","xPercent","yPercent","invertDim","rst","xs","ys","i","min","max","push","apply"],"sourceRoot":"","sources":["../../src/coord/polar.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}