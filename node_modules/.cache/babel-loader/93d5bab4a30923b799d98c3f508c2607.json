{"ast":null,"code":"import { __assign, __extends } from \"tslib\";\nimport { each, isNil, isFunction, isObject } from '@antv/util';\nimport { vec2 } from '@antv/matrix-util';\nimport AxisBase from './base';\nimport * as OverlapUtil from './overlap';\n\nvar Circle =\n/** @class */\nfunction (_super) {\n  __extends(Circle, _super);\n\n  function Circle() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Circle.prototype.getDefaultCfg = function () {\n    var cfg = _super.prototype.getDefaultCfg.call(this);\n\n    return __assign(__assign({}, cfg), {\n      type: 'circle',\n      locationType: 'circle',\n      center: null,\n      radius: null,\n      startAngle: -Math.PI / 2,\n      endAngle: Math.PI * 3 / 2\n    });\n  };\n\n  Circle.prototype.getLinePath = function () {\n    var center = this.get('center');\n    var x = center.x;\n    var y = center.y;\n    var rx = this.get('radius');\n    var ry = rx;\n    var startAngle = this.get('startAngle');\n    var endAngle = this.get('endAngle');\n    var path = [];\n\n    if (Math.abs(endAngle - startAngle) === Math.PI * 2) {\n      path = [['M', x, y - ry], ['A', rx, ry, 0, 1, 1, x, y + ry], ['A', rx, ry, 0, 1, 1, x, y - ry], ['Z']];\n    } else {\n      var startPoint = this.getCirclePoint(startAngle);\n      var endPoint = this.getCirclePoint(endAngle);\n      var large = Math.abs(endAngle - startAngle) > Math.PI ? 1 : 0;\n      var sweep = startAngle > endAngle ? 0 : 1;\n      path = [['M', x, y], ['L', startPoint.x, startPoint.y], ['A', rx, ry, 0, large, sweep, endPoint.x, endPoint.y], ['L', x, y]];\n    }\n\n    return path;\n  };\n\n  Circle.prototype.getTickPoint = function (tickValue) {\n    var startAngle = this.get('startAngle');\n    var endAngle = this.get('endAngle');\n    var angle = startAngle + (endAngle - startAngle) * tickValue;\n    return this.getCirclePoint(angle);\n  }; // 获取垂直于坐标轴的向量\n\n\n  Circle.prototype.getSideVector = function (offset, point) {\n    var center = this.get('center');\n    var vector = [point.x - center.x, point.y - center.y];\n    var factor = this.get('verticalFactor');\n    var vecLen = vec2.length(vector);\n    vec2.scale(vector, vector, factor * offset / vecLen);\n    return vector;\n  }; // 获取沿坐标轴方向的向量\n\n\n  Circle.prototype.getAxisVector = function (point) {\n    var center = this.get('center');\n    var vector = [point.x - center.x, point.y - center.y];\n    return [vector[1], -1 * vector[0]]; // 获取顺时针方向的向量\n  }; // 根据圆心和半径获取点\n\n\n  Circle.prototype.getCirclePoint = function (angle, radius) {\n    var center = this.get('center');\n    radius = radius || this.get('radius');\n    return {\n      x: center.x + Math.cos(angle) * radius,\n      y: center.y + Math.sin(angle) * radius\n    };\n  };\n  /**\n   * 是否可以执行某一 overlap\n   * @param name\n   */\n\n\n  Circle.prototype.canProcessOverlap = function (name) {\n    var labelCfg = this.get('label'); // 对 autoRotate，如果配置了旋转角度，直接进行固定角度旋转\n\n    if (name === 'autoRotate') {\n      return isNil(labelCfg.rotate);\n    } // 默认所有 overlap 都可执行\n\n\n    return true;\n  };\n\n  Circle.prototype.processOverlap = function (labelGroup) {\n    var _this = this;\n\n    var labelCfg = this.get('label');\n    var titleCfg = this.get('title');\n    var verticalLimitLength = this.get('verticalLimitLength');\n    var labelOffset = labelCfg.offset;\n    var limitLength = verticalLimitLength;\n    var titleHeight = 0;\n    var titleSpacing = 0;\n\n    if (titleCfg) {\n      titleHeight = titleCfg.style.fontSize;\n      titleSpacing = titleCfg.spacing;\n    }\n\n    if (limitLength) {\n      limitLength = limitLength - labelOffset - titleSpacing - titleHeight;\n    }\n\n    var overlapOrder = this.get('overlapOrder');\n    each(overlapOrder, function (name) {\n      if (labelCfg[name] && _this.canProcessOverlap(name)) {\n        _this.autoProcessOverlap(name, labelCfg[name], labelGroup, limitLength);\n      }\n    });\n\n    if (titleCfg) {\n      if (isNil(titleCfg.offset)) {\n        // 调整 title 的 offset\n        var length_1 = labelGroup.getCanvasBBox().height; // 如果用户没有设置 offset，则自动计算\n\n        titleCfg.offset = labelOffset + length_1 + titleSpacing + titleHeight / 2;\n      }\n    }\n  };\n\n  Circle.prototype.autoProcessOverlap = function (name, value, labelGroup, limitLength) {\n    var _this = this;\n\n    var hasAdjusted = false;\n    var util = OverlapUtil[name];\n\n    if (limitLength > 0) {\n      if (value === true) {\n        // true 形式的配置：使用 overlap 默认的的处理方法进行处理\n        hasAdjusted = util.getDefault()(false, labelGroup, limitLength);\n      } else if (isFunction(value)) {\n        // 回调函数形式的配置： 用户可以传入回调函数\n        hasAdjusted = value(false, labelGroup, limitLength);\n      } else if (isObject(value)) {\n        // object 形式的配置方式：包括 处理方法 type， 和可选参数配置 cfg\n        var overlapCfg = value;\n\n        if (util[overlapCfg.type]) {\n          hasAdjusted = util[overlapCfg.type](false, labelGroup, limitLength, overlapCfg.cfg);\n        }\n      } else if (util[value]) {\n        // 字符串类型的配置：按照名称执行 overlap 处理方法\n        hasAdjusted = util[value](false, labelGroup, limitLength);\n      }\n    }\n\n    if (name === 'autoRotate') {\n      // 文本旋转后，文本的对齐方式可能就不合适了\n      if (hasAdjusted) {\n        var labels = labelGroup.getChildren();\n        var verticalFactor_1 = this.get('verticalFactor');\n        each(labels, function (label) {\n          var textAlign = label.attr('textAlign');\n\n          if (textAlign === 'center') {\n            // 居中的文本需要调整旋转度\n            var newAlign = verticalFactor_1 > 0 ? 'end' : 'start';\n            label.attr('textAlign', newAlign);\n          }\n        });\n      }\n    } else if (name === 'autoHide') {\n      var children = labelGroup.getChildren().slice(0); // 复制数组，删除时不会出错\n\n      each(children, function (label) {\n        if (!label.get('visible')) {\n          if (_this.get('isRegister')) {\n            // 已经注册过了，则删除\n            _this.unregisterElement(label);\n          }\n\n          label.remove(); // 防止 label 数量太多，所以统一删除\n        }\n      });\n    }\n  };\n\n  return Circle;\n}(AxisBase);\n\nexport default Circle;","map":{"version":3,"mappings":"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","names":["each","isNil","isFunction","isObject","vec2","AxisBase","OverlapUtil","__extends","Circle","cfg","_super","getDefaultCfg","call","type","locationType","center","radius","startAngle","Math","PI","endAngle","get","x","y","rx","ry","path","abs","startPoint","getCirclePoint","endPoint","large","sweep","tickValue","angle","offset","point","vector","factor","vecLen","length","scale","cos","sin","name","labelCfg","rotate","labelGroup","titleCfg","verticalLimitLength","labelOffset","limitLength","titleHeight","titleSpacing","style","fontSize","spacing","overlapOrder","_this","canProcessOverlap","autoProcessOverlap","length_1","getCanvasBBox","height","value","hasAdjusted","util","getDefault","overlapCfg","labels","getChildren","verticalFactor_1","label","textAlign","attr","newAlign","children","slice","unregisterElement","remove"],"sourceRoot":"","sources":["../../src/axis/circle.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}