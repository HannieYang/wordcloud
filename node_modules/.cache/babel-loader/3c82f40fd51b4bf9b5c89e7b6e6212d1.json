{"ast":null,"code":"import { __assign, __extends } from \"tslib\";\nimport { vec2 } from '@antv/matrix-util';\nimport { each, isFunction, isNil, isNumberEqual, isObject } from '@antv/util';\nimport AxisBase from './base';\nimport * as OverlapUtil from './overlap';\n\nvar Line =\n/** @class */\nfunction (_super) {\n  __extends(Line, _super);\n\n  function Line() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Line.prototype.getDefaultCfg = function () {\n    var cfg = _super.prototype.getDefaultCfg.call(this);\n\n    return __assign(__assign({}, cfg), {\n      type: 'line',\n      locationType: 'region',\n\n      /**\n       * 起始点, x, y\n       * @type {object}\n       */\n      start: null,\n\n      /**\n       * 结束点, x, y\n       * @type {object}\n       */\n      end: null\n    });\n  }; // 获取坐标轴线的 path\n\n\n  Line.prototype.getLinePath = function () {\n    var start = this.get('start');\n    var end = this.get('end');\n    var path = [];\n    path.push(['M', start.x, start.y]);\n    path.push(['L', end.x, end.y]);\n    return path;\n  }; // 重新计算 layout bbox，考虑到 line 不显示\n\n\n  Line.prototype.getInnerLayoutBBox = function () {\n    var start = this.get('start');\n    var end = this.get('end');\n\n    var bbox = _super.prototype.getInnerLayoutBBox.call(this);\n\n    var minX = Math.min(start.x, end.x, bbox.x);\n    var minY = Math.min(start.y, end.y, bbox.y);\n    var maxX = Math.max(start.x, end.x, bbox.maxX);\n    var maxY = Math.max(start.y, end.y, bbox.maxY);\n    return {\n      x: minX,\n      y: minY,\n      minX: minX,\n      minY: minY,\n      maxX: maxX,\n      maxY: maxY,\n      width: maxX - minX,\n      height: maxY - minY\n    };\n  };\n\n  Line.prototype.isVertical = function () {\n    var start = this.get('start');\n    var end = this.get('end');\n    return isNumberEqual(start.x, end.x);\n  };\n\n  Line.prototype.isHorizontal = function () {\n    var start = this.get('start');\n    var end = this.get('end');\n    return isNumberEqual(start.y, end.y);\n  };\n\n  Line.prototype.getTickPoint = function (tickValue) {\n    var self = this;\n    var start = self.get('start');\n    var end = self.get('end');\n    var regionX = end.x - start.x;\n    var regionY = end.y - start.y;\n    return {\n      x: start.x + regionX * tickValue,\n      y: start.y + regionY * tickValue\n    };\n  }; // 直线坐标轴下任一点的向量方向都相同\n\n\n  Line.prototype.getSideVector = function (offset) {\n    var axisVector = this.getAxisVector();\n    var normal = vec2.normalize([0, 0], axisVector);\n    var factor = this.get('verticalFactor');\n    var verticalVector = [normal[1], normal[0] * -1]; // 垂直方向，逆时针方向\n\n    return vec2.scale([0, 0], verticalVector, offset * factor);\n  }; // 获取坐标轴的向量\n\n\n  Line.prototype.getAxisVector = function () {\n    var start = this.get('start');\n    var end = this.get('end');\n    return [end.x - start.x, end.y - start.y];\n  };\n\n  Line.prototype.processOverlap = function (labelGroup) {\n    var _this = this;\n\n    var isVertical = this.isVertical();\n    var isHorizontal = this.isHorizontal(); // 非垂直，或者非水平时不处理遮挡问题\n\n    if (!isVertical && !isHorizontal) {\n      return;\n    }\n\n    var labelCfg = this.get('label');\n    var titleCfg = this.get('title');\n    var verticalLimitLength = this.get('verticalLimitLength');\n    var labelOffset = labelCfg.offset;\n    var limitLength = verticalLimitLength;\n    var titleHeight = 0;\n    var titleSpacing = 0;\n\n    if (titleCfg) {\n      titleHeight = titleCfg.style.fontSize;\n      titleSpacing = titleCfg.spacing;\n    }\n\n    if (limitLength) {\n      limitLength = limitLength - labelOffset - titleSpacing - titleHeight;\n    }\n\n    var overlapOrder = this.get('overlapOrder');\n    each(overlapOrder, function (name) {\n      if (labelCfg[name] && _this.canProcessOverlap(name)) {\n        _this.autoProcessOverlap(name, labelCfg[name], labelGroup, limitLength);\n      }\n    });\n\n    if (titleCfg) {\n      if (isNil(titleCfg.offset)) {\n        // 调整 title 的 offset\n        var bbox = labelGroup.getCanvasBBox();\n        var length_1 = isVertical ? bbox.width : bbox.height; // 如果用户没有设置 offset，则自动计算\n\n        titleCfg.offset = labelOffset + length_1 + titleSpacing + titleHeight / 2;\n      }\n    }\n  };\n  /**\n   * 是否可以执行某一 overlap\n   * @param name\n   */\n\n\n  Line.prototype.canProcessOverlap = function (name) {\n    var labelCfg = this.get('label'); // 对 autoRotate，如果配置了旋转角度，直接进行固定角度旋转\n\n    if (name === 'autoRotate') {\n      return isNil(labelCfg.rotate);\n    } // 默认所有 overlap 都可执行\n\n\n    return true;\n  };\n\n  Line.prototype.autoProcessOverlap = function (name, value, labelGroup, limitLength) {\n    var _this = this;\n\n    var isVertical = this.isVertical();\n    var hasAdjusted = false;\n    var util = OverlapUtil[name];\n\n    if (value === true) {\n      var labelCfg = this.get('label'); // true 形式的配置：使用 overlap 默认的的处理方法进行处理\n\n      hasAdjusted = util.getDefault()(isVertical, labelGroup, limitLength);\n    } else if (isFunction(value)) {\n      // 回调函数形式的配置： 用户可以传入回调函数\n      hasAdjusted = value(isVertical, labelGroup, limitLength);\n    } else if (isObject(value)) {\n      // object 形式的配置方式：包括 处理方法 type， 和可选参数配置 cfg\n      var overlapCfg = value;\n\n      if (util[overlapCfg.type]) {\n        hasAdjusted = util[overlapCfg.type](isVertical, labelGroup, limitLength, overlapCfg.cfg);\n      }\n    } else if (util[value]) {\n      // 字符串类型的配置：按照名称执行 overlap 处理方法\n      hasAdjusted = util[value](isVertical, labelGroup, limitLength);\n    }\n\n    if (name === 'autoRotate') {\n      // 文本旋转后，文本的对齐方式可能就不合适了\n      if (hasAdjusted) {\n        var labels = labelGroup.getChildren();\n        var verticalFactor_1 = this.get('verticalFactor');\n        each(labels, function (label) {\n          var textAlign = label.attr('textAlign');\n\n          if (textAlign === 'center') {\n            // 居中的文本需要调整旋转度\n            var newAlign = verticalFactor_1 > 0 ? 'end' : 'start';\n            label.attr('textAlign', newAlign);\n          }\n        });\n      }\n    } else if (name === 'autoHide') {\n      var children = labelGroup.getChildren().slice(0); // 复制数组，删除时不会出错\n\n      each(children, function (label) {\n        if (!label.get('visible')) {\n          if (_this.get('isRegister')) {\n            // 已经注册过了，则删除\n            _this.unregisterElement(label);\n          }\n\n          label.remove(); // 防止 label 数量太多，所以统一删除\n        }\n      });\n    }\n  };\n\n  return Line;\n}(AxisBase);\n\nexport default Line;","map":{"version":3,"mappings":"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","names":["vec2","each","isFunction","isNil","isNumberEqual","isObject","AxisBase","OverlapUtil","__extends","Line","cfg","_super","getDefaultCfg","call","type","locationType","start","end","get","path","push","x","y","bbox","getInnerLayoutBBox","minX","Math","min","minY","maxX","max","maxY","width","height","tickValue","self","regionX","regionY","offset","axisVector","getAxisVector","normal","normalize","factor","verticalVector","scale","labelGroup","isVertical","isHorizontal","labelCfg","titleCfg","verticalLimitLength","labelOffset","limitLength","titleHeight","titleSpacing","style","fontSize","spacing","overlapOrder","name","_this","canProcessOverlap","autoProcessOverlap","getCanvasBBox","length_1","rotate","value","hasAdjusted","util","getDefault","overlapCfg","labels","getChildren","verticalFactor_1","label","textAlign","attr","newAlign","children","slice","unregisterElement","remove"],"sourceRoot":"","sources":["../../src/axis/line.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}