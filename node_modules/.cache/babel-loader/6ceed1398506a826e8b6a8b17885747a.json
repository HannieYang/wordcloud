{"ast":null,"code":"import { __assign, __extends, __rest } from \"tslib\";\nimport { get } from '@antv/util';\nimport GroupComponent from '../abstract/group-component';\nimport { renderTag } from '../util/graphic';\nimport { applyTranslate } from '../util/matrix';\nimport Theme from '../util/theme';\n\nvar DataMarkerAnnotation =\n/** @class */\nfunction (_super) {\n  __extends(DataMarkerAnnotation, _super);\n\n  function DataMarkerAnnotation() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  /**\n   * 默认的配置项\n   * @returns {object} 默认的配置项\n   */\n\n\n  DataMarkerAnnotation.prototype.getDefaultCfg = function () {\n    var cfg = _super.prototype.getDefaultCfg.call(this);\n\n    return __assign(__assign({}, cfg), {\n      name: 'annotation',\n      type: 'dataMarker',\n      locationType: 'point',\n      x: 0,\n      y: 0,\n      point: {},\n      line: {},\n      text: {},\n      direction: 'upward',\n      autoAdjust: true,\n      coordinateBBox: null,\n      defaultCfg: {\n        point: {\n          display: true,\n          style: {\n            r: 3,\n            fill: '#FFFFFF',\n            stroke: '#1890FF',\n            lineWidth: 2\n          }\n        },\n        line: {\n          display: true,\n          length: 20,\n          style: {\n            stroke: Theme.lineColor,\n            lineWidth: 1\n          }\n        },\n        text: {\n          content: '',\n          display: true,\n          style: {\n            fill: Theme.textColor,\n            opacity: 0.65,\n            fontSize: 12,\n            textAlign: 'start',\n            fontFamily: Theme.fontFamily\n          }\n        }\n      }\n    });\n  };\n\n  DataMarkerAnnotation.prototype.renderInner = function (group) {\n    if (get(this.get('line'), 'display')) {\n      this.renderLine(group);\n    }\n\n    if (get(this.get('text'), 'display')) {\n      this.renderText(group);\n    }\n\n    if (get(this.get('point'), 'display')) {\n      this.renderPoint(group);\n    }\n\n    if (this.get('autoAdjust')) {\n      this.autoAdjust(group);\n    }\n  };\n\n  DataMarkerAnnotation.prototype.applyOffset = function () {\n    this.moveElementTo(this.get('group'), {\n      x: this.get('x') + this.get('offsetX'),\n      y: this.get('y') + this.get('offsetY')\n    });\n  };\n\n  DataMarkerAnnotation.prototype.renderPoint = function (group) {\n    var point = this.getShapeAttrs().point;\n    this.addShape(group, {\n      type: 'circle',\n      id: this.getElementId('point'),\n      name: 'annotation-point',\n      attrs: point\n    });\n  };\n\n  DataMarkerAnnotation.prototype.renderLine = function (group) {\n    var line = this.getShapeAttrs().line;\n    this.addShape(group, {\n      type: 'path',\n      id: this.getElementId('line'),\n      name: 'annotation-line',\n      attrs: line\n    });\n  };\n\n  DataMarkerAnnotation.prototype.renderText = function (group) {\n    var textAttrs = this.getShapeAttrs().text;\n\n    var x = textAttrs.x,\n        y = textAttrs.y,\n        text = textAttrs.text,\n        style = __rest(textAttrs, [\"x\", \"y\", \"text\"]);\n\n    var _a = this.get('text'),\n        background = _a.background,\n        maxLength = _a.maxLength,\n        autoEllipsis = _a.autoEllipsis,\n        isVertival = _a.isVertival,\n        ellipsisPosition = _a.ellipsisPosition;\n\n    var tagCfg = {\n      x: x,\n      y: y,\n      id: this.getElementId('text'),\n      name: 'annotation-text',\n      content: text,\n      style: style,\n      background: background,\n      maxLength: maxLength,\n      autoEllipsis: autoEllipsis,\n      isVertival: isVertival,\n      ellipsisPosition: ellipsisPosition\n    };\n    renderTag(group, tagCfg);\n  };\n\n  DataMarkerAnnotation.prototype.autoAdjust = function (group) {\n    var direction = this.get('direction');\n    var x = this.get('x');\n    var y = this.get('y');\n    var lineLength = get(this.get('line'), 'length', 0);\n    var coordinateBBox = this.get('coordinateBBox');\n\n    var _a = group.getBBox(),\n        minX = _a.minX,\n        maxX = _a.maxX,\n        minY = _a.minY,\n        maxY = _a.maxY;\n\n    var textGroup = group.findById(this.getElementId('text-group'));\n    var textShape = group.findById(this.getElementId('text'));\n    var lineShape = group.findById(this.getElementId('line'));\n\n    if (!coordinateBBox) {\n      return;\n    }\n\n    if (textGroup) {\n      if (x + minX <= coordinateBBox.minX) {\n        // 左侧超出\n        var overflow = coordinateBBox.minX - (x + minX);\n        applyTranslate(textGroup, textGroup.attr('x') + overflow, textGroup.attr('y'));\n      }\n\n      if (x + maxX >= coordinateBBox.maxX) {\n        // 右侧超出\n        var overflow = x + maxX - coordinateBBox.maxX;\n        applyTranslate(textGroup, textGroup.attr('x') - overflow, textGroup.attr('y'));\n      }\n    }\n\n    if (direction === 'upward' && y + minY <= coordinateBBox.minY || direction !== 'upward' && y + maxY >= coordinateBBox.maxY) {\n      // 上方或者下方超出\n      var textBaseline = void 0;\n      var factor = void 0;\n\n      if (direction === 'upward' && y + minY <= coordinateBBox.minY) {\n        textBaseline = 'top';\n        factor = 1;\n      } else {\n        textBaseline = 'bottom';\n        factor = -1;\n      }\n\n      textShape.attr('textBaseline', textBaseline);\n\n      if (lineShape) {\n        lineShape.attr('path', [['M', 0, 0], ['L', 0, lineLength * factor]]);\n      }\n\n      applyTranslate(textGroup, textGroup.attr('x'), (lineLength + 2) * factor);\n    }\n  };\n\n  DataMarkerAnnotation.prototype.getShapeAttrs = function () {\n    var lineDisplay = get(this.get('line'), 'display');\n    var pointStyle = get(this.get('point'), 'style', {});\n    var lineStyle = get(this.get('line'), 'style', {});\n    var textStyle = get(this.get('text'), 'style', {});\n    var direction = this.get('direction');\n    var lineLength = lineDisplay ? get(this.get('line'), 'length', 0) : 0;\n    var factor = direction === 'upward' ? -1 : 1;\n    return {\n      point: __assign({\n        x: 0,\n        y: 0\n      }, pointStyle),\n      line: __assign({\n        path: [['M', 0, 0], ['L', 0, lineLength * factor]]\n      }, lineStyle),\n      text: __assign({\n        x: 0,\n        y: (lineLength + 2) * factor,\n        text: get(this.get('text'), 'content', ''),\n        textBaseline: direction === 'upward' ? 'bottom' : 'top'\n      }, textStyle)\n    };\n  };\n\n  return DataMarkerAnnotation;\n}(GroupComponent);\n\nexport default DataMarkerAnnotation;","map":{"version":3,"mappings":"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","names":["get","GroupComponent","renderTag","applyTranslate","Theme","__extends","DataMarkerAnnotation","cfg","_super","getDefaultCfg","call","name","type","locationType","x","y","point","line","text","direction","autoAdjust","coordinateBBox","defaultCfg","display","style","r","fill","stroke","lineWidth","length","lineColor","content","textColor","opacity","fontSize","textAlign","fontFamily","group","renderLine","renderText","renderPoint","moveElementTo","getShapeAttrs","addShape","id","getElementId","attrs","textAttrs","background","maxLength","autoEllipsis","isVertival","ellipsisPosition","tagCfg","lineLength","getBBox","minX","maxX","minY","maxY","textGroup","findById","textShape","lineShape","overflow","attr","textBaseline","factor","lineDisplay","pointStyle","lineStyle","textStyle","path"],"sourceRoot":"","sources":["../../src/annotation/data-marker.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}